#!/usr/bin/expect -f

# Настройка переменных
set timeout 500
set prompt "#"

# Запуск терминала
spawn bash
expect -re $prompt

# Установка самба
send "dnf install samba *krb5* bind\r"
expect -re $prompt

set timeout 60

# Установка самба
send "setenforce 0\r"
expect -re $prompt

# Изменение /etc/selinux/config
send "sed -i 's/^SELINUX=.*/SELINUX=permissive/' /etc/selinux/config\r"
expect -re $prompt

send "echo -e '\[connection\]' > /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e 'id=ens18' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e 'uuid=a58a9970-625b-4bd1-b3f6-80534d2d5981' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e 'type=ethernet' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e 'interface-name=ens18' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e '\[ethernet\]' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e '\[ipv4\]' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e 'address1=192.168.3.2/27,192.168.3.1' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e 'dns=192.168.3.2;' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e 'method=manual' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e 'ignore-auto-dns=true' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e 'dns-search=au-team.irpo;' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e '\[ipv6\]' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e 'addr-gen-mode=default' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e 'method=disabled' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt
send "echo -e '\[proxy\]' >> /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt

send "chmod 600 /etc/NetworkManager/system-connections/enp0s3.nmconnection\r"
expect -re $prompt

send "systemctl restart NetworkManager\r"
expect -re $prompt

# Перезагрузка системы
send "exit\r"
expect eof
